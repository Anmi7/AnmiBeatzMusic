# Data Migration Guide

This document explains how to migrate your existing music data from the current system to the new Laravel + Vue system.

## Current Data Structure

Your `music-data.json` contains tracks with this structure:
```json
{
  "id": 1,
  "title": "Dreams & Nightmares",
  "artist": "Anmi Beatz",
  "genre": "hip-hop",
  "image": "assets/images/music-covers/Title-1.jpg",
  "audioFile": "audio/dreams-and-nightmares.mp3",
  "youtubeLink": "https://youtube.com/...",
  "spotifyLink": "https://open.spotify.com/...",
  "releaseDate": "2024-01-15",
  "featured": true,
  "plays": 125000,
  "duration": "3:45"
}
```

## Migration Steps

### Step 1: Prepare Your Data
Copy your `music-data.json` file to the backend:
```bash
cp music-data.json backend/
```

### Step 2: Create Migration Script
Create `backend/scripts/migrate-music-data.php`:

```php
<?php

// Load the JSON file
$json = file_get_contents(__DIR__ . '/../music-data.json');
$data = json_decode($json, true);

// Map old field names to new database columns
$tracks = [];
foreach ($data['tracks'] as $track) {
    $tracks[] = [
        'title' => $track['title'],
        'artist' => $track['artist'] ?? 'Anmi Beatz',
        'description' => $track['description'] ?? null,
        'genre' => $track['genre'],
        'image_url' => $track['image'],
        'audio_url' => $track['audioFile'],
        'youtube_link' => $track['youtubeLink'] ?? null,
        'spotify_link' => $track['spotifyLink'] ?? null,
        'plays' => $track['plays'] ?? 0,
        'duration' => $track['duration'],
        'release_date' => $track['releaseDate'],
        'featured' => $track['featured'] ?? false,
    ];
}

echo json_encode($tracks, JSON_PRETTY_PRINT);
```

Run it:
```bash
cd backend
php scripts/migrate-music-data.php > seeder-data.json
```

### Step 3: Update Database Seeder
Update `backend/database/seeders/TrackSeeder.php` to read from the migrated data:

```php
<?php

namespace Database\Seeders;

use App\Models\Track;
use Illuminate\Database\Seeder;

class TrackSeeder extends Seeder
{
    public function run(): void
    {
        $json = file_get_contents(database_path('../seeder-data.json'));
        $tracks = json_decode($json, true);
        
        foreach ($tracks as $track) {
            Track::create($track);
        }
    }
}
```

### Step 4: Run the Migration
```bash
cd backend
php artisan db:seed --class=TrackSeeder
```

### Step 5: Verify Migration
Check that all tracks were imported:
```bash
# In Laravel Tinker
php artisan tinker
Track::count() // Should show your track count
Track::first() // Should show a track
```

## Field Mapping Reference

| Old Field | New Field | Notes |
|-----------|-----------|-------|
| `id` | `id` | Auto-generated by Laravel |
| `title` | `title` | ✓ Direct mapping |
| `artist` | `artist` | ✓ Direct mapping |
| `image` | `image_url` | Changed to `*_url` format |
| `audioFile` | `audio_url` | Changed to `*_url` format |
| `youtubeLink` | `youtube_link` | Snake case |
| `spotifyLink` | `spotify_link` | Snake case |
| `releaseDate` | `release_date` | Snake case + date format |
| `featured` | `featured` | ✓ Direct mapping |
| `plays` | `plays` | ✓ Direct mapping |
| `duration` | `duration` | ✓ Direct mapping |

## API Response Format

After migration, your Vue frontend will receive data like:

```json
{
  "id": 1,
  "title": "Dreams & Nightmares",
  "artist": "Anmi Beatz",
  "genre": "hip-hop",
  "image_url": "assets/images/music-covers/Title-1.jpg",
  "audio_url": "audio/dreams-and-nightmares.mp3",
  "youtube_link": "https://youtube.com/...",
  "spotify_link": "https://open.spotify.com/...",
  "release_date": "2024-01-15",
  "featured": true,
  "plays": 125000,
  "duration": "3:45",
  "created_at": "2024-01-15T00:00:00.000000Z",
  "updated_at": "2024-01-15T00:00:00.000000Z"
}
```

## Audio & Image Files

### Copy Files to Public Directory
```bash
# From project root
cp -Recurse audio backend\public\
cp -Recurse assets backend\public\
```

### Update URLs in Database
If your URLs need to change, use:
```bash
php artisan tinker
Track::where('image_url', 'LIKE', 'assets/%')->update(['image_url' => DB::raw("CONCAT('public/', image_url)")]);
```

## Rollback if Needed

If something goes wrong:
```bash
# Delete all tracks
php artisan tinker
Track::truncate()

# Roll back migrations
php artisan migrate:rollback

# Re-run everything
php artisan migrate
php artisan db:seed --class=TrackSeeder
```

## Quick Check Commands

```bash
# Connect to database
php artisan tinker

# Check data
Track::all()
Track::where('featured', true)->count()
Track::where('genre', 'hip-hop')->count()

# Update if needed
Track::find(1)->update(['plays' => 150000])

# Exit
exit
```

---

**Troubleshooting**:
- If tracks don't appear in API, check CORS settings in `config/cors.php`
- If image/audio URLs are broken, verify files are in `public/` folder
- If dates are wrong, ensure `release_date` is in YYYY-MM-DD format
